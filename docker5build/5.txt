Сегодня я буду работать с дж в связке с докером 
*будет докер-пайп который будет собирать докер образы 

Докер
*есть докерфайл - это сценарий который описывает сборку образа 
*в результате выполненого докерфайла получаем докер образ 
*из докеробраза можно запускать докер-контейнер 

-------------------------------------------------
в фото докер-имедж 
слева пример обычного докер-образа от состоит из слоёв , каждая инструкция в докер-файле добовляет новый слой 
в правой части вижу образ который состоит из слоёв который доступны только для чтения (грубо говоря команды которые там исполняються они там есть и они меняются  , НО когда мы запускаем из этого образа контейнер то он являеться слоём для чтения и для записи 

-------------------------------------------------


Теперь практика 
Я выполню практически тоже самое что было в прошлом слайде , на гитхабе буду хранить пайп (который будет выполнять действия ) и саму инструкцию (докер-файл) , дж будет клонировать репу , брать докер-файл и собирать этот докерфайл (в дальнейшем это будет сделано с отправкой и проверкой с нескольк ветками но пока всё просто )  


Для начала надо установить докер на дж (есть плагины но проще всё самому устанвоить через оболочку а потом Дж просто указать где это находиться )
1) ищё офф докер мануал по установке 
2) после установки надо проверить как он работает * ОН ДОЛЖЕН РАБОТАТЬ НА ПОЛЬЗ. ДЖ ТАК-КАК ДЖ БУДЕТ ЗАПУСКАТЬ ВСЕ СБОРКИ 
*так как я устанавливал через рута а не через дж , надо перейти на польз. дж , и надо через него юзать - docker run hello-world(скачать хелло ворлд , из докер регистри (докерхаба) и запустить из него контейнер ) в результате этой команды будет предуприжд связаное с запретом на докер-сокет - на что надо добавить польз Дж в группу Докер - usermod -aG docker jenkins 
*сам дж как служба запущ по умолч при старке пк , и поэтому эго надо ребутнуть чтоб он увидел изминения - su , systemctl restart jenkins 


Теперь обьяснение докер-билд.дж пайп 
*всё тоже самое НО пайп выполняет в директории тулбокс команду docker build . - говорит докеру , собрать образ в текущ директории , так как это пайп , этот пайп будет выкачиватся из репы гита , знач там есть дикетрочия тулбокс 
в самом тулбоксе в докерфайле , есть базовый образ alpine(минимальный линукс для докеров) , добавить в него пакеты ... cmd tailf -f /dev/null - при запуске образа не дает ему сразу умереть (дает возможность залогин , и сделать всё тонкую работу руками в образе )



-------------------------
Теперь я иду в дж гуи и создаю новый айтем - docker-build и это будет обычный пайп , теперь надо делать то что я делал раньше(указать что это будет скрипт с гита ... и путь к дж.файлу)
*console output 
смотрит репу , выкачивате 
выполняет сборку 
выполн команду докер билд , дальше ставить все пакеты 
*степы добавляют слои к нашему докер образу 

Теперь стоит просто заглянуть в машину с докером (дж ) - docker images - там будет 2 имг (один алпайн , дургой наш созданый образ) 


ВЫВОД 
СДЕЛАЛ ЭЛЕМЕНТАРНЫЙ ПАЙП (ОСНОВНОЙ, ПОДГОТОВЛЕНИЕ ДЛЯ СБОРКИ НОРМАЛЬНЫХ ДОКЕР ОБРАЗОВ , СТАВИТЬ НА НИХ КРАСИВЫЕ МЕТКИ И ПРОДУМАТЬ СВОЮ СТРАТЕГИЮ ) ДАЛЬШЕ БУДЕТ БОЛЬШЕ  

